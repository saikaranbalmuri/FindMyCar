
<!DOCTYPE html>
<html lang="en">
<head>
<!-- Theme Made By www.w3schools.com - No Copyright -->
<title>Find My Car</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://d3js.org/d3.v3.min.js"></script>
<script
	src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>

<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link href="https://fonts.googleapis.com/css?family=Montserrat"
	rel="stylesheet">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="./js/datamaps.world.min.js?v=1"></script>

 <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
 
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script src="https://cdn.rawgit.com/novus/nvd3/v1.8.1/build/nv.d3.min.js"></script>
    <link rel="stylesheet" href="https://cdn.rawgit.com/novus/nvd3/v1.8.1/build/nv.d3.css">
	<link rel="stylesheet" href="http://www.w3schools.com/w3css/4/w3.css">
<style type="text/css">
.row {
	margin: 0px;
}

.bar {
	background-size: contain;
}

.bar-production{
	background-size: contain;
	 fill: #45B39D;

}

.dot {
	stroke: #000;
}

.bar:hover {
	fill: #045125;
}

.axis {
	font: 12px;
}
.node:hover
{
stroke: #000;
stroke-width: 1px;
   box-shadow: 10px 10px grey;
}
.axis path, .axis line {
	fill: none;
	stroke: #ddd;
	shape-rendering: crispEdges;
}
.navbar-inverse .navbar-brand {
    color: #ffffff;
}
.link {
	stroke: #aaa;
}

.node text {
	stroke: #333;
	cursos: pointer;
}

#myTip{
color:black;
background: white;
}

.d3-tip {
	line-height: 1;
	font-weight: bold;
	padding: 12px;
	background: rgba(234, 234, 234, 0.8);
	color: #fff;
	border-radius: 2px;
}

/* Creates a small triangle extender for the tooltip */
.d3-tip:after {
	box-sizing: border-box;
	display: inline;
	font-size: 10px;
	width: 100%;
	line-height: 1;
	color: rgba(0, 0, 0, 0.8);
	content: "\25BC";
	position: absolute;
	text-align: center;
}

/* Style northward tooltips differently */
.d3-tip.n:after {
	margin: -1px 0 0 0;
	top: 100%;
	left: 0;
}
.d3-tipSpec {
	line-height: 1;
	font-weight: bold;
	padding: 12px;
	background: rgba(234, 234, 234, 0.8);
	color: #fff;
	border-radius: 2px;
}

/* Creates a small triangle extender for the tooltip */
.d3-tipSpec:after {
	box-sizing: border-box;
	display: inline;
	font-size: 10px;
	width: 100%;
	line-height: 1;
	color: rgba(0, 0, 0, 0.8);
	content: "\25BC";
	position: absolute;
	text-align: center;
}

/* Style northward tooltips differently */
.d3-tipSpec.n:after {
	margin: -1px 0 0 0;
	top: 100%;
	left: 0;
}
.datamaps-hoverover
{
	position: absolute;
	top:1px;
	left:2px;
}

.hoverinfo
{
	position: absolute;
	top:1px;
	left:2px;
} 

path {
	stroke: steelblue;
	stroke-width: 2;
	fill: none;
}

.axis path, .axis line {
	fill: none;
	stroke: black;
	stroke-width: 1;
	shape-rendering: crispEdges;
}

.node text {
	stroke: #333;
	cursos: pointer;
}
.domain
{
stroke: black; 
stroke-width: 1.5px;
}
text {
	font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
}

.toolTip {
	font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
	position: absolute;
	display: none;
	width: auto;
	height: auto;
	background: none repeat scroll 0 0 white;
	border: 0 none;
	border-radius: 8px 8px 8px 8px;
	box-shadow: -3px 3px 15px #888888;
	color: black;
	font: 12px sans-serif;
	padding: 5px;
	text-align: center;
}

.legend {
	font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
	font-size: 60%;
}

rect {
	stroke-width: 2;
}

text {
	font: 10px sans-serif;
}

.axis text {
	font: 10px sans-serif;
}



.axis line {
	fill: none;
	stroke: #000;
	shape-rendering: crispEdges;
}

.axis .tick line {
	stroke-width: 1;
	stroke: rgba(0, 0, 0, 0.2);
}

.axisHorizontal path {
	fill: none;
}

.axisHorizontal line {
	fill: none;
	stroke: #000;
	shape-rendering: crispEdges;
}

.axisHorizontal .tick line {
	stroke-width: 1;
	stroke: rgba(0, 0, 0, 0.2);
}

.bar {
	fill-opacity: .9;
}


</style>
<script type="text/javascript">
//panel color--84c7bd
	var container;
	var priceSearch;
	var selCategory="";
			var maxBarVal = "0";
		var minBarVal ="0";
		//"#28B463","#82E0AA",
		var minBarColor="#28B463";
		var maxBarColor="#0E6655";
		
	var myCharge=-80;
	
	var sort_by = function(field, reverse, primer){

	   var key = primer ? 
		   function(x) {return primer(x[field])} : 
		   function(x) {return x[field]};

	   reverse = !reverse ? 1 : -1;

	   return function (a, b) {
		   return a = key(a), b = key(b), reverse * ((a > b) - (b > a));
		 } 
	}
	
	
	
	$(document).ready(function() {

						$.getJSON("http://www.cs.odu.edu/~kkallepalli/FindMyCar/CarPricesSearchable.json",function(data) {
											//console.log(data);
											priceSearch = data;
										});
					

						loadCharts();
						loadNetworkChart("Sedan");
						loadBubbleChart();
						//loadBrandSalesChart("Ford");
						$(".sortAttr").change(function () {
						   //console.log($(".sortAttr").val());
						   specCompareChart();
						});
						$(".sortOrder").change(function () {
						   //console.log($(".sortOrder").val());
						   specCompareChart();
						});


						$( function() {
						$( "#slider-range" ).slider({
						  range: true,
						  min: 0,
						  max: 1500000,
						  values: [ 0, 25000 ],
						  slide: function( event, ui ) {
							$( "#minAmount" ).text( "$" + ui.values[0]);
							$( "#maxAmount" ).text(" $" + ui.values[1]);
							
							loadNetworkChart(selCategory);
							
						  }
						});
						
						$("#minAmount" ).text( "$" + $( "#slider-range" ).slider( "values", 0 ));
						$("#maxAmount" ).text( " $" + $( "#slider-range" ).slider( "values", 1 ));
					  } );
					});

	var dataset = [];
	var linkCars = [];
	var clickedLinkCars = [];
	
	var carProductionData;

	function loadCharts() {
		
	 var brandData;
  var basic_choropleth;
  
  var colors = d3.scale.category10();
	

	d3.json("./production.json", function(error, data) {
			carProductionData=data;
	});

		nv.addGraph(function() {
		  var chart = nv.models.stackedAreaChart()
		                .x(function(d) { return d[0] })
		                .y(function(d) { return d[1] })
		                .clipEdge(true)
		                .useInteractiveGuideline(true)
		                ;
		
		  chart.xAxis
		      .showMaxMin(false)
		      .tickFormat(function(d) { return d3.time.format('%x')(new Date(d)) });
		
		  chart.yAxis
		      .tickFormat(d3.format(',.2f'));
		
		  d3.select('#chart svg')
		    .datum(data)
		      .transition().duration(500).call(chart);
		
		  nv.utils.windowResize(chart.update);
		
		  return chart;
		});



	d3.json("BrandCountries.json", function(error, data) {
		brandData=data;
		
		var mapdata={};

		  basic_choropleth = new Datamap({
			element : document.getElementById("map"),
			projection : 'mercator',
			fills : {
				defaultFill : "#606060",
				authorHasTraveledTo : "#4eb1d6"
			},
			data : {
			
			},
			done : function(datamap) {
				datamap.svg.selectAll('.datamaps-subunit').on('click',
						function(geography) {
								drawTrendLine(geography.id);
								
								$("#mapHoverInfo").empty();
								var tableData="<table class='table table-responsive table-striped table-bordered'><thead><tr><td>Brand</td><td>Website</td><td>Image</td></tr></thead>";
								
								var hoverBrands=brandData[geography.id];
								for(key in hoverBrands)
									{
									tableData= tableData + "<tr><td><b>"+hoverBrands[key].brand+"</b></td><td><a href='"+hoverBrands[key].website+"'>View</a></td><td><img width='90' height='70' src='"+hoverBrands[key].image+"' /></td></tr>";
									}
								
								tableData = tableData+ "</table>";
								$("#mapHoverInfo").append(tableData);
						})
						 .on("mousemove",function(d){
								$("#myTip").attr("style","position:absolute;top:"+(event.pageY+5)+"px;left:"+(event.pageX+10)+"px;display:block;");
								$("#myTip").empty();
								$("#myTip").append("<div>"+d.properties.name+ " , Brands : "+brandData[d.id].length+"</div>");
								$("#myTip").show();
								console.log(d);
					})
					 .on("mouseover",function(d){
						$("#myTip").attr("style","position:absolute;top:"+(event.pageY+5)+"px;left:"+(event.pageX+10)+"px;display:block;");
						$("#myTip").empty();
						$("#myTip").append("<div>"+d.properties.name+"</div>");
						$("#myTip").show();
						console.log(d);
					})
					 .on("mouseout",function(d){
						$("#myTip").hide();
						console.log(d);
					});
				
				/* datamap.svg.selectAll('.datamaps-subunit').on('mouseover',
						function(geography) {
								$("#mapHoverInfo").empty();
								var tableData="<table class='table table-responsive table-striped table-bordered'><thead><tr><td>Brand</td><td>Website</td><td>Image</td></tr></thead>";
								
								var hoverBrands=brandData[geography.id];
								for(key in hoverBrands)
									{
									tableData= tableData + "<tr><td><b>"+hoverBrands[key].brand+"</b></td><td><a href='"+hoverBrands[key].website+"'>View</a></td><td><img width='90' height='70' src='"+hoverBrands[key].image+"' /></td></tr>";
									}
								
								tableData = tableData+ "</table>";
								$("#mapHoverInfo").append(tableData);
						}); */
			}
		}); 
		  
		  for(key in brandData){
			  if(key in mapdata)
				  {
				
				  }
			  else{
				  mapdata[key]=brandData[key].length;
			  }
		  }
		  
		  var mapcolorData=[];
		  for(key in mapdata){
			  mapcolorData.push({"country":key,"brands":mapdata[key]})
		  }
		  
		  var colorScale1 = d3.scale.linear()
	  	  .domain([d3.min(mapcolorData, function(d) { return d.brands; }), d3.max(mapcolorData, function(d) { return d.brands; })])
	      .range(["#f9d4d1", "#fc5649"]);
/* 		  
		  console.log(d3.min(mapcolorData, function(d) { return d.brands; }));
		  console.log(d3.max(mapcolorData, function(d) { return d.brands; }));
		   */
		  for(key in mapdata){
			mapdata[key]=colorScale1(mapdata[key]);
		  }
		  
		  basic_choropleth.updateChoropleth(mapdata);
	});
		
	}

	function drawTrendLine(country_name){
		
		//console.log(carProductionData);

		$.each(carProductionData,function(i,cdata){
			if(cdata.alpha == country_name)
				{
				$("#countrySales").empty();
				
				var mydata=[];
				
				for(key in cdata)
					{
					if (key != "country" && key != "country_code" && key!= "alpha")
						{
						mydata.push({"Letter":key,"Freq":cdata[key]})
						}
					
					}
				
				var margin = {top: 20, right: 20, bottom: 70, left: 60},
			    width = 600 - margin.left - margin.right,
			    height = 500 - margin.top - margin.bottom;


			// set the ranges
			var x = d3.scale.ordinal().rangeRoundBands([0, width], .05);

			var y = d3.scale.linear().range([height, 0]);

			// define the axis
			var xAxis = d3.svg.axis()
			    .scale(x)
			    .orient("bottom")


			var yAxis = d3.svg.axis()
			    .scale(y)
			    .orient("left")
			    .ticks(10);
			
			var tip = d3.tip()
			  .attr('class', 'd3-tip')
			  .offset([-10, 0])
			  .html(function(d) {
			    return "<span style='color:red'> " + d.Letter+" :"+d.Freq + " (In Thousands) </span>";
			  })



			// add the SVG element
			var svg = d3.select("#countrySales").append("svg")
			    .attr("width", width + margin.left + margin.right)
			    .attr("height", height + margin.top + margin.bottom)
			  .append("g")
			    .attr("transform", 
			          "translate(" + margin.left + "," + margin.top + ")");
			
			svg.call(tip);

				
			  // scale the range of the data
			  x.domain(mydata.map(function(d) { return d.Letter; }));
			  y.domain([0, d3.max(mydata, function(d) { return d.Freq; })]);

			  // add axis
			  svg.append("g")
			      .attr("class", "x axis")
			      .attr("transform", "translate(0," + height + ")")
			      .call(xAxis)
			    .selectAll("text")
			      .style("text-anchor", "end")
			      .attr("dx", "-.8em")
			      .attr("dy", "-.55em")
			      .attr("transform", "rotate(-90)" );
			  
				// Add the text label for the x axis
			    svg.append("text")
			        .attr("transform", "translate(" + (width / 2) + " ," + (height + margin.bottom -10) + ")")
			        .style("text-anchor", "middle")
			        .text("Year");

				

			  svg.append("g")
			      .attr("class", "y axis")
			      .call(yAxis)
			    .append("text")
			      .attr("y",-15)
					.attr("x",100)
			      .attr("dy", ".71em")
			      .style("text-anchor", "end")
			      .text("Sales in Thousand Units");


			  // Add bar chart
			  svg.selectAll("bar")
			      .data(mydata)
			    .enter().append("rect")
			        .on('mouseover', tip.show)
  					.on('mouseout', tip.hide)
			      .attr("class", "bar-production")
			      .attr("x", function(d) { return x(d.Letter); })
			      .attr("width", x.rangeBand())
			      .attr("y", function(d) { return y(d.Freq); })
			      .attr("height", function(d) { return height - y(d.Freq); });
				
				}
		});
		
		
	}

	
	function maxValHelper(data,category){

		var maxval =d3.max(data, function(d) {
			return d[category];
		});

		return maxval;
	}

	function minValHelper(data,category){

		var min =d3.min(data, function(d) {
			return d[category];
		});

		return min;
	}

	function getFillMinMaxColor(curVal){
			if(maxBarVal == curVal){
						return maxBarColor;
					}else if(minBarVal == curVal){
						return minBarColor;
					}else{
						return "#45B39D";
					}
	}


	function specCompareChart() {
		$("#ccChart").empty();
		$("#rpmChart").empty();
		$("#mileageChart").empty();
		$("#priceChart").empty();
		$("#heightChart").empty();
		$("#widthChart").empty();

		console.log("loading spec chart -");

		if ($("#price").prop("checked")) {
			$("#priceChart").show();
		} else {
			$("#priceChart").hide();
		}

		if ($("#rpm").prop("checked")) {
			$("#rpmChart").show();
		} else {
			$("#rpmChart").hide();
		}

		if ($("#mileage").prop("checked")) {
			$("#mileageChart").show();
		} else {
			$("#mileageChart").hide();
		}

		if ($("#carHeight").prop("checked")) {
			$("#heightChart").show();
		} else {
			$("#heightChart").hide();
		}
		if ($("#carWidth").prop("checked")) {
			$("#widthChart").show();
		} else {
			$("#widthChart").hide();
		}
		if ($("#price").prop("checked")) {
			$("#priceChart").show();
		} else {
			$("#priceChart").hide();
		}

		//d3.json("./2010alldata.json", function(data) {
		var data = clickedLinkCars;
		var count = 0;
		var modelNames = [];
		//console.log(data);
		dataset = [];
		modelNames = [];
		pricedata=[];
		$.each(data, function(i, d) {
			var carname = (d.group + " " + d.name).trim();
			//console.log("===="+d.group+" "+d.name+"====");
			//console.log(priceSearch["Honda CR-V"])
			if (priceSearch[carname] != null) {
// 				console.log(carname + "   === " + priceSearch[carname].mileage
// 						+ " :: " + priceSearch[carname].price);
				
				d.mileage=priceSearch[carname].mileage;
				d.price=priceSearch[carname].price;
				//console.log(d);
			} else {
				console.log(d);
			}

			modelNames.push(d.group + " " + d.name);
			var rpm, cc, mileage;
			/* if(d.cc==null){cc=0}else{cc=d.cc}
			if(d.torquerpm==null){rpm=0}else{rpm=d.torquerpm}
			if(d.mileage==null){mileage=0}else{mileage=d.mileage}
			dataset.push({"id":count,"model":d.group+" "+d.name,"label":d.group+" "+d.name+" "+d.name,"engine_cc":cc,"torque":parseFloat(rpm),"mileage":parseFloat(mileage),"dtype":d.dtype});
			 */
			count += 1;
		});

		//console.log(data);
		if($(".sortOrder").val()=="lth")
		{
		switch($(".sortAttr").val())
		{
			case "enginecc":
		        data.sort(sort_by('cc', false, parseInt));
		        break;
		    case "power":
		        data.sort(sort_by('enginepower', false, parseInt));
		        break;
		    case "mileage":
		        data.sort(sort_by('mileage', false, parseInt));
		        break;
		    case "price":
		        data.sort(sort_by('price', false, parseInt));
		        break;
		    default:
		        data.sort(sort_by('cc', false, parseInt));
		        break;
		    case "height":
		        data.sort(sort_by('height', false, parseInt));
		        break;
		    case  "width":
		        data.sort(sort_by('width', false, parseInt));
		        break;
		    case  "name":
		        data.sort(function(a,b) {
					    if ( a.group+" "+a.name <  b.group+" "+b.name )
					        return -1;
					    if (  a.group+" "+a.name > b.group+" "+b.name )
					        return 1;
					    return 0;
					} );
		        break;
		}
	}
	else if($(".sortOrder").val()=="htl")
	{
		switch($(".sortAttr").val())
		{
			case "enginecc":
		        data.sort(sort_by('cc', true, parseInt));
		        break;
		    case "power":
		        data.sort(sort_by('enginepower', true, parseInt));
		        break;
		    case "mileage":
		        data.sort(sort_by('mileage', true, parseInt));
		        break;
		    case "price":
		        data.sort(sort_by('price', true, parseInt));
		        break;
		    default:
		        data.sort(sort_by('cc', true, parseInt));
		        break;
		    case "height":
		        data.sort(sort_by('height', true, parseInt));
		        break;
		    case  "width":
		        data.sort(sort_by('width', true, parseInt));
		        break;
		    case  "name":
		       data.sort(function(a,b) {
					    if ( a.group+" "+a.name <  b.group+" "+b.name )
					        return 1;
					    if (  a.group+" "+a.name > b.group+" "+b.name )
					        return -1;
					    return 0;
					} );
		        break;
		}
	}
		var margin = {
			top : 20,
			right : 30,
			bottom : 30,
			left : 200
		}, width = window.innerWidth / 4.5- margin.left - margin.right, height = 300
				- margin.top - margin.bottom;

		var y = d3.scale.ordinal().rangeRoundBands([ 0, height - 50 ], .3);

		var x = d3.scale.linear().range([ 0, width ]);

		y.domain(data.map(function(d) {
			return d.group + " " + d.name;
		}));
		x.domain([ 0, d3.max(data, function(d) {
			return parseInt(d.cc);
		}) ]);

		var xAxis = d3.svg.axis().scale(x).ticks(3).orient("bottom");

		var yAxis = d3.svg.axis().scale(y).orient("left");

		var tip = d3
				.tip()
				.attr('class', 'd3-tipSpec ')
				.offset([ -5, -5 ])
				.html(
						function(d) {
							console.log(d);
							return "<strong'> <span style='color:red'>Car:"
									+ d.group
									+ " "
									+ d.name
									+ "<br> Engine CC : " + d.cc + 
									 ", Engine Power : " + d.enginepower + 
									 "<br> Mileage : " + d.mileage +
									", Price : " + d.price +
									"<br> Width : " + d.width +
									", Height : " + d.height +
									" </span> </strong>";
						});


		maxBarVal = maxValHelper(data,"cc");
		minBarVal = minValHelper(data,"cc");
		var chart = d3.select("#ccChart").append("svg").attr("width",
				width + margin.left + margin.right).attr("height",
				height + margin.top + margin.bottom).append("g").attr(
				"transform", "translate(" + margin.left + ",0)");

		chart.call(tip);

		chart.append("g").attr("class", "x axis").attr("transform",
				"translate(0," + (height - margin.bottom) + ")").call(xAxis)
				.selectAll("text");

		// Add the text label for the x axis
		chart.append("text").attr(
				"transform",
				"translate(" + (width / 2) + " ," + (height + margin.bottom)
						+ ")").style("text-anchor", "middle").text("Engine CC");

		chart.append("g").attr("class", "y axis").attr("transform",
				"translate(0,0)").call(yAxis).append("text").style(
				"text-anchor", "start");

		chart.append("text").attr("transform", "rotate(-90)").attr("y",
				0 - margin.left).attr("x", 0 - (height / 2)).attr("dy", "1em")
				.style("text-anchor", "middle").text("Model Name");

		chart.selectAll("bar").data(data).enter().append("rect")
			.attr("category",function(d){
				var category = d.name;
				return category;
			})
			.on('click',
				function(d) {
					$(".brandPanel").show();
					$(".safetyPanel").show();
					$(".specCompare").find("rect").css("stroke","none");
					loadBrandSalesChart(d.group);
					loadScatterPlotChart(d.group, d.name);
					$("rect[category='"+d.name+"']").css("stroke","black");
					$("rect[category='"+d.name+"']").css("stroke-width","3px");
				}).on('mouseover', tip.show).on('mouseout', tip.hide).attr("x",
				0).transition().duration(1000).delay(function(d, i) {
			return i * 100;
		}).attr("height", y.rangeBand()).attr("y", function(d) {
			return y(d.group + " " + d.name);
		}).attr("width", function(d) {
			return x(parseInt(d.cc));
		}).attr("class", "bar").attr("fill",function(d){
			return getFillMinMaxColor(d.cc)				
		});
		
	
		var color=[{"name":"Min","value":"#28B463"},{"name":"Max","value":"#0E6655"}];
		var legendNames=["","",""];
		
		  var legend = chart.selectAll(".legend")
		      .data(color)
		    	.enter().append("g")
		      .attr("class", "legend")
		      .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });
	
		  legend.append("rect")
		      .attr("x", -150)
		      .attr("width", 18)
		      .attr("height", 18)
		      .style("fill", function(d){
		    	 return d.value;
		      });
	
		  legend.append("text")
		      .attr("x", -155)
		      .attr("y", 9)
		      .attr("dy", ".35em")
		      .style("text-anchor", "end")
		      .text(function(d) { return d.name; });
		  
		
		margin.left = 10;
		margin.right = 5;

		//power bar chart
		var x1 = d3.scale.linear().range([ 0, width ]);

		x1.domain([ 0, d3.max(data, function(d) {
			return d.enginepower;
		}) ]);

		var xAxis1 = d3.svg.axis().scale(x1).ticks(3).orient("bottom");
		maxBarVal = maxValHelper(data,"enginepower");
		minBarVal = minValHelper(data,"enginepower");
		var chart1 = d3.select("#rpmChart").append("svg").attr("width",
				width + margin.left + margin.right).attr("height",
				height + margin.top + margin.bottom).append("g").attr(
				"transform", "translate(" + margin.left + ",0)");

		chart1.append("g").attr("class", "x axis").attr("transform",
				"translate(0," + (height - margin.bottom) + ")").call(xAxis1)
				.selectAll("text");

		// Add the text label for the x axis
		chart1.append("text").attr(
				"transform",
				"translate(" + (width / 2) + " ," + (height + margin.bottom)
						+ ")").style("text-anchor", "middle").text(
				"Engine Power");

		chart1.selectAll("bar").data(data).enter().append("rect")
			.attr("category",function(d){
				var category = d.name;
				return category;
			})
		.on(
				'mouseover', tip.show).on('mouseout', tip.hide).attr("x", 0)
				.attr("height", y.rangeBand())
				.attr("y", function(d) {
					return y(d.group + " " + d.name);
				})
				.on('click',
				function(d) {
					$(".brandPanel").show();
					$(".safetyPanel").show();
					$(".specCompare").find("rect").css("stroke","none");
					loadBrandSalesChart(d.group);
					loadScatterPlotChart(d.group, d.name);
					$("rect[category='"+d.name+"']").css("stroke","black");
					$("rect[category='"+d.name+"']").css("stroke-width","3px");
				}).transition().duration(1000).delay(function(d, i) {
			return i * 100;
		})
				.attr("width", function(d) {

					
					return x1(d.enginepower);
				})
				.attr("class", "bar").attr("fill",function(d){
					return getFillMinMaxColor(d.enginepower)				
				});

		margin.left = 10;
		//mileage bar chart
		var x2 = d3.scale.linear().range([ 0, width ]);

		x2.domain([ 0, d3.max(data, function(d) {
			return d.height;
		}) ]);

		var xAxis2 = d3.svg.axis().scale(x2).ticks(3).orient("bottom");

		maxBarVal = maxValHelper(data,"height");
		minBarVal = minValHelper(data,"height");
		var chart2 = d3.select("#heightChart").append("svg").attr("width",
				width + margin.left + margin.right).attr("height",
				height + margin.top + margin.bottom).append("g").attr(
				"transform", "translate(" + margin.left + ",0)");

		chart2.append("g").attr("class", "x axis").attr("transform",
				"translate(0," + (height - margin.bottom) + ")").call(xAxis2)
				.selectAll("text");

		// Add the text label for the x axis
		chart2.append("text").attr(
				"transform",
				"translate(" + (width / 2) + " ," + (height + margin.bottom)
						+ ")").style("text-anchor", "middle").text("Height");

		chart2.selectAll("bar").data(data).enter().append("rect")	.attr("category",function(d){
				var category = d.name;
				return category;
			}).on(
				'mouseover', tip.show).on('mouseout', tip.hide).attr("x", 0)
				.attr("height", y.rangeBand()).attr("y", function(d) {
					return y(d.group + " " + d.name);
				}).attr("width", function(d) {
					return x2(d.height);
				})
				.on('click',
				function(d) {
					$(".brandPanel").show();
					$(".safetyPanel").show();
					$(".specCompare").find("rect").css("stroke","none");
					loadBrandSalesChart(d.group);
					loadScatterPlotChart(d.group, d.name);
					$("rect[category='"+d.name+"']").css("stroke","black");
					$("rect[category='"+d.name+"']").css("stroke-width","3px");
				}).transition().duration(1000).delay(function(d, i) {
			return i * 100;
		})
				.attr("class", "bar").attr("fill",function(d){
					return getFillMinMaxColor(d.height)				
				});

				margin.left = 10;
		//mileage bar chart
		var x3 = d3.scale.linear().range([ 0, width ]);

		x3.domain([ 0, d3.max(data, function(d) {
			return d.width;
		}) ]);

		var xAxis3 = d3.svg.axis().scale(x3).ticks(3).orient("bottom");

		maxBarVal = maxValHelper(data,"width");
		minBarVal = minValHelper(data,"width");
		var chart3 = d3.select("#widthChart").append("svg").attr("width",
				width + margin.left + margin.right).attr("height",
				height + margin.top + margin.bottom).append("g").attr(
				"transform", "translate(" + margin.left + ",0)");

		chart3.append("g").attr("class", "x axis").attr("transform",
				"translate(0," + (height - margin.bottom) + ")").call(xAxis3)
				.selectAll("text");

		// Add the text label for the x axis
		chart3.append("text").attr(
				"transform",
				"translate(" + (width / 2) + " ," + (height + margin.bottom)
						+ ")").style("text-anchor", "middle").text("Width");

		chart3.selectAll("bar").data(data).enter().append("rect")	.attr("category",function(d){
				var category = d.name;
				return category;
			}).on(
				'mouseover', tip.show).on('mouseout', tip.hide).attr("x", 0)
				.attr("height", y.rangeBand()).attr("y", function(d) {
					return y(d.group + " " + d.name);
				}).on('click',
				function(d) {
					$(".brandPanel").show();
					$(".safetyPanel").show();
					$(".specCompare").find("rect").css("stroke","none");
					loadBrandSalesChart(d.group);
					loadScatterPlotChart(d.group, d.name);
					$("rect[category='"+d.name+"']").css("stroke","black");
					$("rect[category='"+d.name+"']").css("stroke-width","3px");
				}).transition().duration(1000).delay(function(d, i) {
			return i * 100;
		}).attr("width", function(d) {
					return x3(parseInt(d.width));
				}).attr("class", "bar").attr("fill",function(d){
					return getFillMinMaxColor(d.width)				
				});
					margin.left = 10;
		//mileage bar chart
		var x4 = d3.scale.linear().range([ 0, width ]);

		x4.domain([ 0, d3.max(data, function(d) {
			return d.mileage;
		}) ]);

		var xAxis4 = d3.svg.axis().scale(x4).ticks(3).orient("bottom");

		maxBarVal = maxValHelper(data,"mileage");
		minBarVal = minValHelper(data,"mileage");
		var chart4 = d3.select("#mileageChart").append("svg").attr("width",
				width + margin.left + margin.right).attr("height",
				height + margin.top + margin.bottom).append("g").attr(
				"transform", "translate(" + margin.left + ",0)");

		chart4.append("g").attr("class", "x axis").attr("transform",
				"translate(0," + (height - margin.bottom) + ")").call(xAxis4)
				.selectAll("text");

		// Add the text label for the x axis
		chart4.append("text").attr(
				"transform",
				"translate(" + (width / 2) + " ," + (height + margin.bottom)
						+ ")").style("text-anchor", "middle").text("Mileage");

		chart4.selectAll("bar").data(data).enter().append("rect")	.attr("category",function(d){
				var category = d.name;
				return category;
			}).on(
				'mouseover', tip.show).on('mouseout', tip.hide).attr("x", 0)
				.attr("height", y.rangeBand()).attr("y", function(d) {
					return y(d.group + " " + d.name);
				}).on('click',
				function(d) {
					$(".brandPanel").show();
					$(".safetyPanel").show();
					$(".specCompare").find("rect").css("stroke","none");
					loadBrandSalesChart(d.group);
					loadScatterPlotChart(d.group, d.name);
					$("rect[category='"+d.name+"']").css("stroke","black");
					$("rect[category='"+d.name+"']").css("stroke-width","3px");
				}).transition().duration(1000).delay(function(d, i) {
			return i * 100;
		}).attr("width", function(d) {
					return x4(d.mileage);
				}).attr("class", "bar").attr("fill",function(d){
					return getFillMinMaxColor(d.mileage)				
				});
					margin.left = 10;
		//mileage bar chart
		var x5 = d3.scale.linear().range([ 0, width ]);

		x5.domain([ 0, d3.max(data, function(d) {
			return d.price;
		}) ]);

		var xAxis5 = d3.svg.axis().scale(x5).ticks(3).orient("bottom");

		maxBarVal = maxValHelper(data,"price");
		minBarVal = minValHelper(data,"price");
		var chart5 = d3.select("#priceChart").append("svg").attr("width",
				width + margin.left + margin.right).attr("height",
				height + margin.top + margin.bottom).append("g").attr(
				"transform", "translate(" + margin.left + ",0)");

		chart5.append("g").attr("class", "x axis").attr("transform",
				"translate(0," + (height - margin.bottom) + ")").call(xAxis5)
				.selectAll("text");

		// Add the text label for the x axis
		chart5.append("text").attr(
				"transform",
				"translate(" + (width / 2) + " ," + (height + margin.bottom)
						+ ")").style("text-anchor", "middle").text("Price");

		chart5.selectAll("bar").data(data).enter().append("rect")	.attr("category",function(d){
				var category = d.name;
				return category;
			}).on(
				'mouseover', tip.show).on('mouseout', tip.hide).attr("x", 0)
				.attr("height", y.rangeBand()).attr("y", function(d) {
					return y(d.group + " " + d.name);
				}).on('click',
				function(d) {
					$(".brandPanel").show();
					$(".safetyPanel").show();
					$(".specCompare").find("rect").css("stroke","none");
					loadBrandSalesChart(d.group);
					loadScatterPlotChart(d.group, d.name);
					$("rect[category='"+d.name+"']").css("stroke","black");
					$("rect[category='"+d.name+"']").css("stroke-width","3px");
				}).transition().duration(1000).delay(function(d, i) {
			return i * 100;
		}).attr("width", function(d) {
					return x5(d.price);
				}).attr("class", "bar").attr("fill",function(d){
					return getFillMinMaxColor(d.price)				
				});
		//});	
	}


	function loadNetworkChart(model_body) {
		
		$("#networkChart").empty();
		$("#networkTitle").text(model_body+"'s");

		//$(".d3-tip").remove();
		var margin = {
			top : -5,
			right : -5,
			bottom : -5,
			left : -5
		};
		var width = window.innerWidth*9/12-100, height = 1000;

		var zoom = d3.behavior.zoom().scaleExtent([ 1, 10 ]).on("zoom", zoomed);

		var drag = d3.behavior.drag().origin(function(d) {
			return d;
		}).on("dragstart", dragstarted).on("drag", dragged).on("dragend",
				dragended);

		var tip = d3.tip().attr('class', 'd3-tip ').offset([ -10, 0 ]).html(
				function(d) {
					var tiptext = "<p class='w3-tooltip' style='color:black;weight:bold;' align='center'></br>";
					if(d.length==1)
						{
						$.each(d, function(i, car) {
							
							//console.log(car);
							tiptext += "<span class='w3-text w3-tag w3-animate-opacity' style='display:inline;background:transparent;color:black;'>"
									+ car.group + " - " + car.name + " : "
									+ car.country + " : " + car.dtype
									+ "</span><br>";
											
						});
					}
					else{
					   var commonAttr=[];
					   for(key in d[0])
					   {
					  
					        var val=d[0][key];
							//console.log(val);
							var flag=true;
							for(var i=1;i<d.length;i++)
							{
							   if (val != d[i][key])
							   {
							   flag=false;
								break;
							   }
							}
							
							if(flag)
							{
							console.log(key+" -- "+val);
							commonAttr.push({"attr":key,"value":val});
							}
					   }
					tiptext += "Common Features <br>";
					   $.each(commonAttr, function(i, attrname) {
							tiptext += "<span class='w3-text w3-tag w3-animate-opacity' style='display:inline;background:transparent;color:black;'>"
									+ attrname["attr"]+" : "+attrname["value"]
									+ "</span><br>";
					   });
					
					}
					
					
					tiptext += "</p>";
					return tiptext;
				});

		var svg = d3.select("#networkChart").append("svg").attr("width", width)
				.attr("height", height).append("g").attr("transform",
						"translate(" + margin.left + "," + margin.right + ")")
				.call(zoom);

		svg.call(tip);
		container = svg.append("g");

		svg.style("cursor", "move");

		var force = d3.layout.force().gravity(.05).distance(500).charge(myCharge)
				.size([ width, height ]);

		d3.json("./" + $("#sel1").val() + "data" + model_body + ".json",
				function(error,jsondata) {
					// d3.json("http://www.cs.odu.edu/~rgudipati/cs725/FindMyCar/2010Sedan.json", function(error, json) {
					var json=jsondata;
					console.log(json);
					console.log("before filter : "+json.links.length);
					var filterLinks=[];
					
					var minAmt=parseInt($("#minAmount").text().replace("$",""));
					var maxAmt=parseInt($("#maxAmount").text().replace("$",""));

					$.each(json.links,function(i,link){
						console.log();
						
						var csname=json.nodes[link.source].group+" "+json.nodes[link.source].name;
						var ctname=json.nodes[link.target].group+" "+json.nodes[link.target].name;
						var csprice=0;
						var ctprice=0;

						if(priceSearch[csname]!=null)
							{
							csprice=priceSearch[csname].price;	
							}
						
						if(priceSearch[ctname]!=null)
						{
							ctprice=priceSearch[ctname].price;	
						}
						
						
						
						if(csprice !=0 && ctprice !=0)
							{
							//console.log(csprice+" - "+ctprice);
								 if( (csprice>=minAmt &&  csprice<= maxAmt) && (ctprice>=minAmt &&  ctprice<= maxAmt) )
								 {
								 	//console.log(link);
									 filterLinks.push(link);
								 }
							}
						
					});
					
					json.links=filterLinks;
					
					console.log("after filter : "+filterLinks.length);
					

					force.nodes(json.nodes).links(json.links).start();
					
				

					var link = container.selectAll(".link").data(json.links)
							.enter().append("line").attr("class", "link")
							.style("opacity", function(d) {
								var csname=d.source.group+" "+d.source.name;
								var ctname=d.source.group+" "+d.source.name;
								var csprice=0;
								var ctprice=0;

								if(priceSearch[csname]!=null)
									{
									csprice=priceSearch[csname].price;	
									}
								
								if(priceSearch[ctname]!=null)
								{
									ctprice=priceSearch[ctname].price;	
								}
								
								if(csprice !=0 && ctprice !=0)
									{
									 if( (csprice>=minAmt &&  csprice<= maxAmt) && (ctprice>=minAmt &&  ctprice<= maxAmt) )
									 {
										 return 1;
									 }
									 else
										 {
											return 0;
										 }
									
									}
								else if(csprice !=0 && ctprice ==0)
									{
									return 0;
									}
								else
									{
									return 0;
									}
								
			

							});

					var node = container.selectAll(".node").data(json.nodes)
							.enter().append("g").attr("class", "node")
							.style("opacity",function(d){
								var cname=d.group+" "+d.name;
								if(priceSearch[cname]!=null)
									{
									var cprice=priceSearch[cname].price;
									
									 if(cprice>=minAmt && cprice<= maxAmt)
										 {
										 return 1;
										 }
									 else
										 {
										console.log(cname+" -- "+cprice);
										 return 0;
										 }
									}
								else
									{
									return 1;
									}
							})
							.call(force.drag);

					node.append("image").attr("xlink:href",
							"./" + model_body + ".png").attr("x", -25).attr(
							"y", -25).attr("width", 50).attr("height", 50);
					
							/* .on("mouseover",function(d) {

								d3.select(this).attr("width", 70).attr(
										"height", 70).attr("x", -35).attr("y",
										-35);
							}).on("mouseout",function(d) {
								tip.hide();
								d3.select(this).attr("width", 50).attr(
										"height", 50).attr("x", -25).attr("y",
										-25);
							}); */
					
					
					node.on("click", function(d) {
						$(".specsPanel").show();
						clickedLinkCars = [];
						//clickedLinkCars.push(d);
						link.style('stroke-width', function(l) {
							
						   //console.log(d === l.source);
						   //console.log(d === l.target);
							if (d === l.source) {
								clickedLinkCars.push(l.target);
								return 5;
							} else if (d === l.target) {
								clickedLinkCars.push(l.source);
								return 5;
							} else {
								console.log("D - "+d.group+" "+d.name);
								return 1;
							}
						});
						if(clickedLinkCars.length==0){
							clickedLinkCars.push(d);
						}
						console.log(clickedLinkCars);
					$('html, body').animate({
		        		scrollTop: $("#specsPanel").offset().top
		    		}, 1000);
						specCompareChart();
					});

					node.on("mouseover", function(d) {
						linkCars = [];
						link.style('stroke-width', function(l) {
							if (d === l.source) {
								linkCars.push(l.target);
								return 5;
							} else if (d === l.target) {
								linkCars.push(l.source);
								return 5;
							} else {
								return 1;
							}
						});
						if(linkCars.length==0){
							linkCars.push(d);
						}
						tip.show(linkCars);
						link.style('stroke', function(l) {
							if (d === l.source || d === l.target)
								return "#ff0000";
							else
								return "#aaa";
						});
						console.log("Link Cars : "+linkCars.length);
					});

					node.on("mouseout", function(d) {
						link.style('stroke-width', function(l) {
							return 1;
						});
						link.style('stroke', function(l) {
							if (d === l.source || d === l.target)
								return "#aaa";
						});
						tip.hide();
					});

					node.append("text").attr("dx", -10).attr("dy", -20).text(
							function(d) {
								return d.name;
							});

					node.append("title").text(function(d) {
						return d.name;
					});

					force.on("tick", function() {
						link.attr("x1", function(d) {
							return d.source.x;
						}).attr("y1", function(d) {
							return d.source.y;
						}).attr("x2", function(d) {
							return d.target.x;
						}).attr("y2", function(d) {
							return d.target.y;
						});

						node.attr("transform", function(d) {
							return "translate(" + d.x + "," + d.y + ")";
						});
					});

				});
	}

	function zoomed() {
		container.attr("transform", "translate(" + d3.event.translate
				+ ")scale(" + d3.event.scale + ")");
	}

	function dragstarted(d) {
		d3.event.sourceEvent.stopPropagation();
		d3.select(this).classed("dragging", true);
	}

	function dragged(d) {
		d3.select(this).attr("cx", d.x = d3.event.x).attr("cy",
				d.y = d3.event.y);
	}

	function dragended(d) {
		d3.select(this).classed("dragging", false);
	}

	function loadBubbleChart() {
		$("#bubbleChart").empty();
		
		var diameter = (window.innerWidth*3/12)-20, format = d3.format(",d"), color = d3.scale
				.category20c();

		var bubble = d3.layout.pack().sort(null).size([ diameter, diameter ])
				.padding(1.5);

		var svg = d3.select("#bubbleChart").append("svg").attr("width",
				diameter).attr("height", diameter).attr("class", "bubble");

		var tooltip = d3.select("body").append("div").style("position",
				"absolute").style("z-index", "10")
				.style("visibility", "hidden").style("color", "white").style(
						"padding", "8px").style("background-color",
						"rgba(0, 0, 0, 0.75)").style("border-radius", "6px")
				.style("font", "12px sans-serif").text("tooltip");

		d3.json($("#sel1").val() + "Bubbledata.json", function(error, data) {
			//console.log(data);
			var node = svg.selectAll(".node").data(bubble.nodes(classes({
				"name" : "flare",
				"children" : data
			})).filter(function(d) {
				return !d.children;
			})).enter().append("g").attr("class", "node").attr("transform",
					function(d) {
						return "translate(" + d.x + "," + d.y + ")";
					});

			// console.log(bubble.nodes(data));

			node.append("circle").attr("r", function(d) {
				return d.r;
			}).style("fill", function(d) {
				return color(d.packageName);
			}).on("mouseover", function(d) {
				tooltip.text(d.packageName + ": " + format(d.value));

				tooltip.style("visibility", "visible");
			}).on("click", function(d) {
				$("#bubbleChart").find("circle").css("stroke","none");
				$(this).css("stroke","black");
				$(this).css("stroke-width","2px");
				selCategory=d.packageName;
				loadNetworkChart(d.packageName);
			}).on(
					"mousemove",
					function() {

						return tooltip.style("top",
								(d3.event.pageY - 10) + "px").style("left",
								(d3.event.pageX + 10) + "px");
					}).on("mouseout", function() {
				return tooltip.style("visibility", "hidden");
			});

			node.append("text").attr("dy", ".3em").style("text-anchor",
					"middle").style("pointer-events", "none").text(function(d) {
				return d.packageName;
			});
		});

		function classes(root) {
			var classes = [];

			function recurse(name, node) {
				if (node.children)
					node.children.forEach(function(child) {
						recurse(node.model_body, child);
					});
				else
					classes.push({
						packageName : node.model_body,
						className : node.model_body,
						value : node.count
					});
			}

			recurse(null, root);
			return {
				children : classes
			};
		}

	}

	function loadBrandSalesChart(automaker) {
	
		$("#brandSalesTitle").text(" Sales Trend of "+automaker);
	
		$('html, body').animate({
		        		scrollTop: $("#brandPanel").offset().top-450
		    		}, 1000);
		$("#brandSalesChart").empty();
		var data = [];
		d3.json("carsales.json",
				function(error, dataset) {
					// console.log(dataset);
					dataset.forEach(function(d) {

						if (d["Automaker"] == automaker) {
							// console.log(d["Automaker"]+"---"+automaker);
							data.push({
								"Year" : 2010,
								"sale" : d["2010YearEnd"]
							});
							data.push({
								"Year" : 2011,
								"sale" : d["2011YearEnd"]
							});
							data.push({
								"Year" : 2012,
								"sale" : d["2012YearEnd"]
							});
							data.push({
								"Year" : 2013,
								"sale" : d["2013YearEnd"]
							});
							data.push({
								"Year" : 2014,
								"sale" : d["2014YearEnd"]
							});
						}
					});

					// console.log(data);
					var margin = {
						top : 30,
						right : 20,
						bottom : 30,
						left : 100
					}, width = 600 - margin.left - margin.right, height = 270
							- margin.top - margin.bottom;

					var parseDate = d3.time.format("%d-%m-%Y").parse;
					// Set the ranges
					var x = d3.time.scale().range([ 0, width ]);
					var y = d3.scale.linear().range([ height, 0 ]);

					// Define the axes
					var xAxis = d3.svg.axis().scale(x).orient("bottom")
							.ticks(5);

					var yAxis = d3.svg.axis().scale(y).orient("left").ticks(5);

					// Define the line
					var valueline = d3.svg.line().x(function(d) {
						return x(d.Year);
					}).y(function(d) {
						return y(d.sale);
					});

					// Adds the svg canvas
					var svg = d3.select("#brandSalesChart").append("svg").attr(
							"width", width + margin.left + margin.right).attr(
							"height", height + margin.top + margin.bottom)
							.append("g").attr(
									"transform",
									"translate(" + margin.left + ","
											+ margin.top + ")");

					// Get the data

					data.forEach(function(d) {
						//console.log(d);
						d.Year = parseDate("01-01-" + d.Year);
						d.sale = +d.sale;
					});

					// Scale the range of the data
					x.domain(d3.extent(data, function(d) {
						//console.log(d.Year);
						return d.Year;
					}));
					y.domain([ 0, d3.max(data, function(d) {
						return d.sale;
					}) ]);

					// Add the valueline path.
					var path=svg.append("path").attr("class", "line").attr("d",
							valueline(data));

					// Add the X Axis
					svg.append("g").attr("class", "x axis").attr("transform",
							"translate(0," + height + ")").call(xAxis);

					// Add the Y Axis
					svg.append("g").attr("class", "y axis").call(yAxis);
					var totalLength = path.node().getTotalLength();
					d3.select(path.node())
						  .attr("stroke-dasharray", totalLength  ) 
						  .attr("stroke-dashoffset", totalLength)
						  .transition()
							.duration(1000)
							.ease("linear")
							.attr("stroke-dashoffset", 0);
				svg.append("text").attr(
					"transform",
					"translate(" + (width / 2) + " ," + (height + margin.bottom)
							+ ")").style("text-anchor", "middle").text("Year");
				
		
		svg.append("text").attr("transform", "rotate(-90)").attr("y",
				0 - margin.left).attr("x", 0 - (height / 2)).attr("dy", "1em")
				.style("text-anchor", "middle").text("Sale");
				});

		//loadScatterPlotChart("FIAT", "A8");

	}

	function loadScatterPlotChart(make, model) {
		$("#safetyRatingChart").empty();
		$("#safetyTitle").text(" Safety Rating and Recalls of "+make+" "+model);
		var margin = {
			top : 30,
			right : 40,
			bottom : 30,
			left : 50
		}, width = 600 - margin.left - margin.right, height = 270 - margin.top
				- margin.bottom;

		var parseDate = d3.time.format("%d-%m-%Y").parse;

		var x = d3.time.scale().range([ 0, width ]);
		var y0 = d3.scale.linear().range([ height, 0 ]);
		var y1 = d3.scale.linear().range([ height, 0 ]);

		var xAxis = d3.svg.axis().scale(x).orient("bottom").ticks(5);

		var yAxisLeft = d3.svg.axis().scale(y0).orient("left").ticks(5);

		var yAxisRight = d3.svg.axis().scale(y1).orient("right").ticks(5);
		var tooltip = d3.select("body").append("div").attr("class", "tooltip")
				.style("opacity", 0);

		var valueline = d3.svg.line().x(function(d) {
			return x(d.Year);
		}).y(function(d) {
			return y0(d.Rating);
		});

		var valueline2 = d3.svg.line().x(function(d) {
			return x(d.Year);
		}).y(function(d) {
			return y1(d.recall);
		});

		var svg = d3.select("#safetyRatingChart").append("svg").attr("width",
				width + margin.left + margin.right).attr("height",
				height + margin.top + margin.bottom).append("g").attr(
				"transform",
				"translate(" + margin.left + "," + margin.top + ")");

		// Get the data
		var newdataset;
		d3.json("reduced.json", function(error, newdata) {
			Object.keys(newdata).forEach(function(d) {
				//console.log(model + "---" + d);
				if (model.toLowerCase() == d.toLowerCase())
					newdataset = newdata[d]["rating"];
				//console.log(newdataset);

			});

			// change string (from CSV) into number format
			newdataset.forEach(function(d) {
				if (d.Rating == "Not Rated")
					d.Rating = Math.floor(Math.random() * 6) + 1;
				d.recall = +d.recall;
				d.Rating = +d.Rating;
				d.YearLabel = d.Year;
				d.Year = parseDate("01-01-" + d.Year);

				//    console.log(d);
			});

			// Scale the range of the data
			x.domain(d3.extent(newdataset, function(d) {
				return d.Year;
			}));
			y0.domain([ 0, d3.max(newdataset, function(d) {
				return Math.max(d.Rating);
			}) ]);
			y1.domain([ 0, d3.max(newdataset, function(d) {
				return Math.max(d.recall);
			}) ]);

			var path=svg.append("path") // Add the valueline path.
			.attr("d", valueline(newdataset));

			var path1=svg.append("path") // Add the valueline2 path.
			.style("stroke", "red").attr("d", valueline2(newdataset));

			svg.append("g") // Add the X Axis
			.attr("class", "x axis").attr("transform",
					"translate(0," + height + ")").call(xAxis);

			svg.append("g").attr("class", "y axis").style("fill", "steelblue")
					.call(yAxisLeft);

			svg.append("g").attr("class", "y axis").attr("transform",
					"translate(" + width + " ,0)").style("fill", "red").call(
					yAxisRight);

			svg.selectAll("dot").data(newdataset).enter().append("circle")
					.attr("r", 3.5).attr("cx", function(d) {
						return x(d.Year);
					}).attr("cy", function(d) {
						return y0(d.Rating);
					}).style("fill", "#0000ff").on(
							"mouseover",
							function(d) {
								tooltip.transition().duration(200).style(
										"opacity", .9);
								tooltip.html(
										"Rating " + d.Rating + " <br/>Year:"
												+ d.YearLabel).style("left",
										(d3.event.pageX + 5) + "px").style(
										"top", (d3.event.pageY - 28) + "px");
							}).on("mouseout", function(d) {
						tooltip.transition().duration(500).style("opacity", 0);
					});
					 var totalLength = path.node().getTotalLength();
					d3.select(path.node())
						  .attr("stroke-dasharray", totalLength  ) 
						  .attr("stroke-dashoffset", totalLength)
						  .transition()
							.duration(1000)
							.ease("linear")
							.attr("stroke-dashoffset", 0);
					var totalLength1 = path1.node().getTotalLength();
					d3.select(path1.node())
						  .attr("stroke-dasharray", totalLength1  ) 
						  .attr("stroke-dashoffset", totalLength1)
						  .transition()
							.duration(1000)
							.ease("linear")
							.attr("stroke-dashoffset", 0);
			svg.selectAll("dot").data(newdataset).enter().append("circle")
					.attr("r", 3.5).attr("cx", function(d) {
						return x(d.Year);
					}).attr("cy", function(d) {
						return y1(d.recall);
					}).style("fill", "#ff0000").on(
							"mouseover",
							function(d) {
								tooltip.transition().duration(200).style(
										"opacity", .9);
								tooltip.html(
										"Recall  : " + d.recall + " <br/>Year:"
												+ d.YearLabel).style("left",
										(d3.event.pageX + 5) + "px").style(
										"top", (d3.event.pageY - 28) + "px");
							}).on("mouseout", function(d) {
						tooltip.transition().duration(500).style("opacity", 0);
					});
			svg.append("text").attr(
					"transform",
					"translate(" + (width / 2) + " ," + (height + margin.bottom)
							+ ")").style("text-anchor", "middle").text("Year");
				
		
		svg.append("text").attr("transform", "rotate(-90)").attr("y",
				0 - margin.left).attr("x", 0 - (height / 2)).attr("dy", "1em")
				.style("text-anchor", "middle").text("Safety Rating");
		
		svg.append("text").attr("transform", "rotate(-90)").attr("y",
				0 +width+ margin.right-12).attr("x", 0 - (height / 2)).attr("dy", "1em")
				.style("text-anchor", "middle").text("Recall");		


		});
	}
</script>
</head>
<body>

	<!-- Navbar -->
	<nav class="navbar navbar-inverse">
		<div class="container-fluid">
			<div class="navbar-header">
				<a class="navbar-brand" href="#">Find My Car</a>
			</div>
			<ul class="nav navbar-nav">
				<li><a data-toggle="tab" href="#menu1">Know</a></li>
				<li><a data-toggle="tab" href="#menu2">Find</a></li>
		</div>
	</nav>

	<div class="tab-content">
		<div id="menu1" class="row tab-pane fade in active" style="margin:20px;">
			
		   <div class="row">
		   
		   	<div class="w3-card w3-hover-shadow w3-center  col-sm-8">
							
								<header class="w3-container">
								<h4>Brand Distribution</h4>
								</header>

								<div class="w3-container">
									  	<div id="map" class="w3-card w3-hover-shadow" style="height:60vh;"></div>
								</div>
								
		    </div>
							
							
	         
				
	 			<div id="mapHoverInfo"  style="height:400px;overflow-y:auto;display:inline;" class="col-sm-4"></div>
           
           </div>
			
			<div class="row">
						<div class="panel panel-info w3-card w3-hover-shadow" style="margin-top:10px;">
								<div class="panel-heading">
									<h4>Passenger Car Sales</h4>
									</div>
								<div class="panel-body">
								<div id="countrySales" class=""></div>
								</div>
					</div>
			  </div>
			
			<div id="allCountriesChart"></div>
			
		</div>

		<div id="menu2" class="row tab-pane fade " style="margin-top: -1.2%;">
			
				<div class="panel panel-default" style="margin:20px;">
					<div class="panel-heading" >
					<form class="form-inline" style="margin-left: 10%;>
									<label for="sel1">Year:</label> <select class="form-control"
										id="sel1" onchange="loadBubbleChart()">
										<option value="2010">2010</option>
										<option value="2011">2011</option>
										<option value="2012">2012</option>
										<option value="2013">2013</option>
									</select>
									<label for="amount" style="margin-left: 6%;">Price range:</label>
								  <p id="minAmount" readonly style="border:0; color:#f6931f; font-weight:bold;display:inline;min-width:50px;"></p>
								  <div style="width:200px;display:inline-block; margin-left:10px;margin-right:10px;" id="slider-range"></div>
								  <p id="maxAmount" readonly style="border:0; color:#f6931f; font-weight:bold;display:inline;"></p>
								</form>
					</div>
					<div class="panel-body">
					
						<div class="col-sm-3" style="padding:0px;margin-right:10px;">
						
							<div class="row w3-card w3-hover-shadow w3-center">
							
								<header class="w3-container w3-blue">
								<h4>Types of Cars </h4>
								</header>

								<div class="w3-container">
									<div id="bubbleChart"></div>
								</div>
								
							</div>
							
							<div class="row w3-card w3-hover-shadow w3-center" style="margin-top:10px;">
							
								<header class="w3-container w3-blue">
								<h4>Cars by Body Type</h4>
								</header>

								<div class="w3-container">
								<div id="">
								<div class="container">
								  
								  <div id="myCarousel" class="carousel slide" data-ride="carousel" style="width:300px;">
									<!-- Indicators -->
									

									<!-- Wrapper for slides -->
									<div class="carousel-inner">

									  <div class="item active">
										<img src="./carosel/coupe.jpg"  style="width:100%;">
										<div class="carousel-caption">
										  
										  
										</div>
										<h3 style="color:red;">coupe</h3>
									  </div>

									  <div class="item">
										<img src="./carosel/convertible.jpg" style="width:100%;">
										<div class="carousel-caption">
										  
										 
										</div>
										<h3 style="color:red;">convertible</h3>
									  </div>
									
									  <div class="item">
										<img src="./carosel/crossover.jpg" style="width:100%;">
										<div class="carousel-caption">
										  
										
										</div>
										<h3 style="color:red;">crossover</h3>
									  </div>
									  <div class="item">
										<img src="./carosel/hatchback.jpg" style="width:100%;">
										<div class="carousel-caption">
										  
										
										</div>
										<h3 style="color:red;">hatchback</h3>
									  </div>
									  <div class="item">
										<img src="./carosel/minivan.jpg" style="width:100%;">
										<div class="carousel-caption">
										  <h3 style="color:red;">minivan</h3>
										
										</div>
									  </div>
									  <div class="item">
										<img src="./carosel/panelvan.jpg" style="width:100%;">
										<div class="carousel-caption">
										 
										
										</div>
										 <h3 style="color:red;">panelvan</h3>
									  </div>
									  <div class="item">
										<img src="./carosel/pickup.jpg" style="width:100%;">
										<div class="carousel-caption">
										  
										
										</div>
										<h3 style="color:red;">pickup</h3>
									  </div>
									  <div class="item">
										<img src="./carosel/roadster.jpg" style="width:100%;">
										<div class="carousel-caption">
										 
										
										</div>
										 <h3 style="color:red;">roadster</h3>
									  </div>
									  <div class="item">
										<img src="./carosel/sedan.jpg" style="width:100%;">
										<div class="carousel-caption">
										  
										
										</div>
										<h3 style="color:red;">sedan</h3>
									  </div>
									  <div class="item">
										<img src="./carosel/stationwagon.jpg" style="width:100%;">
										<div class="carousel-caption">
										  
										
										</div>
										<h3 style="color:red;">stationwagon</h3>
									  </div>
									  <div class="item">
										<img src="./carosel/suv.jpg" style="width:100%;">
										<div class="carousel-caption">
										  
										
										</div>
										<h3 style="color:red;">suv</h3>
									  </div>
									  <div class="item">
										<img src="./carosel/van.jpg" style="width:100%;">
										<div class="carousel-caption">
										  
										
										</div>
										<h3 style="color:red;">van</h3>
									  </div>
								  
									</div>

									<!-- Left and right controls -->
									<a class="left carousel-control" href="#myCarousel" data-slide="prev">
									  <span class="glyphicon glyphicon-chevron-left"></span>
									  <span class="sr-only">Previous</span>
									</a>
									<a class="right carousel-control" href="#myCarousel" data-slide="next">
									  <span class="glyphicon glyphicon-chevron-right"></span>
									  <span class="sr-only">Next</span>
									</a>
								  </div>
								</div>
</div>
								</div>
								
							</div>
						
						</div>
						
						<div class="col-sm-8 w3-card w3-hover-shadow w3-center" style="padding:0px;">
							<header class="w3-container w3-blue">
							<h4 id="networkTitle">Network Charts</h4>
							</header>

							<div class="w3-container">
								<div id="networkChart"></div>
							</div>
							
						</div >
						
						
						
						
					</div>
				</div>
			
			
				 <div id="specsPanel" class="w3-card w3-hover-shadow w3-center row specsPanel" style="display:none; margin:20px;">
							<div class="panel panel-default">
								<div class="panel-heading" style="background: #2196F3;" >
									<h3 style="margin-left: 6%;color: white;">Specifications Compare</h3>
									<form class="form-inline" style=" margin-left: 6%;">
										<div class="form-group">
											<input type="checkbox" id="engineCC" value="EngineCC"
												checked="checked" disabled="disabled"
												onclick="specCompareChart()" /> <label for="engineCC">Engine
												CC</label>
										</div>
										<div class="form-group">
											<input type="checkbox" id="rpm" value="EngineCC" checked="checked"
												onclick="specCompareChart()" /> <label for="rpm">Power</label>
										</div>
										<div class="form-group">
											<input type="checkbox" id="mileage" value="EngineCC" checked="checked"
												onclick="specCompareChart()" /> <label for="mileage">Mileage</label>
										</div>
										<div class="form-group">
											<input type="checkbox" id="price" value="EngineCC" checked="checked"
												onclick="specCompareChart()" /> <label for="price">Price</label>
										</div>
										<div class="form-group">
											<input type="checkbox" id="carHeight" value="EngineCC" checked="checked"
												onclick="specCompareChart()" /> <label for="carHeight">Height</label>
										</div>
										<div class="form-group">
											<input type="checkbox" id="carWidth" value="EngineCC" checked="checked"
												onclick="specCompareChart()" /> <label for="carWidth">Width</label>
										</div>
										<label style="margin-left: 34%;">Sort :</label>
										<div class="form-group">
									
											<select class="sortAttr form-inline">
											  <option value="name">Name</option>
											  <option value="enginecc">Engine CC</option>
											  <option value="power">Power</option>
											  <option value="mileage">Mileage</option>
											  <option value="price">Price</option>
											  <option value="height">Height</option>
											  <option value="width">Width</option>
											</select>
											<select class="sortOrder form-inline">
											  <option value="lth">Low to High</option>
											  <option value="htl">High to Low</option>						 
											</select>
										</div>
									</form>
								</div>
								<div class="panel-body specCompare" style=" margin-left: 6%;">
									<div id="ccChart" style="display: inline;"></div>
									<div id="rpmChart" style="display: inline;"></div>
									<div id="mileageChart" style="display: inline;"></div>
									<div id="priceChart" style="display: inline;"></div>
									<div id="widthChart" style="display: inline;"></div>
									<div id="heightChart" style="display: inline;"></div>
								</div>
							</div>

						</div>





						<div id="brandPanel" class="w3-card w3-hover-shadow w3-center panel brandPanel panel-default col-sm-12 col-lg-5 col-md-6 col-xs-12" style="display:none; margin-left: 3%;">
							<div class="panel-heading" style="width: 104%;margin-left: -2%;"><p id="brandSalesTitle" style="display:inline;"></p></div>
							<div class="panel-body" id="brandSalesChart"></div>
						</div>
						<div class="col-lg-1">
						</div>
						

						<div id="safetyPanel"
							class="w3-card w3-hover-shadow w3-center panel safetyPanel panel-default col-sm-12 col-lg-5 col-md-6 col-xs-12" style="display:none; margin-left: -3%;">
							<div class="panel-heading" style="width: 104%;margin-left: -2%;"><p id="safetyTitle" style="display:inline;"></p></div>
							<div class="panel-body" id="safetyRatingChart"></div>
						</div>
						
		</div>
	</div>

    <div id="myTip"></div>
	<svg>
	  <defs>
	    <pattern id="myroad" patternUnits="objectBoundingBox" height="1"
			width=".1">
	      <image x="0" y="0" preserveAspectRatio="none"
			xlink:href="./road.png"></image>
	    </pattern>
	  </defs>
	</svg>


	<!-- Footer -->
	<footer class="container-fluid text-center"
		style="position: fixed; bottom: 0; width: 100%; color: white;">
		<p></p>
	</footer>

</body>
</html>
